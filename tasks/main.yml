---
# Install a custom service
- name: Download the package
  get_url:
    url: "{{ custom_service_pkg_url }}"
    dest: "/home/{{ ansible_ssh_user }}/"
    force: no
    validate_certs: false

- name: Unarchive the package
  unarchive:
    src: "/home/{{ ansible_ssh_user }}/{{ custom_service_filename }}"
    dest: "/home/{{ ansible_ssh_user }}/"
    copy: no


# custom service init scripts
- file:
    path: /usr/lib/systemd/system
    state: directory
    mode: 0755

- name: Prepare the service init file in /usr/lib/systemd/system/ folder
  template:
    src: "templates/{{ custom_service_name }}.service.j2"
    dest: "/usr/lib/systemd/system/{{ custom_service_name }}.service"
    mode: 0755

# this will enable automatic starting after a reboot by create few symlink
- name: Make sure the service can be started after reboot
  command: systemctl enable {{ custom_service_name }}.service

# systemd ansible module not available for ansible < 2.2, therefore, using command module instead
- name: Reload and restart the custom service daemon via command
  command: systemctl daemon-reload
  notify: restart {{ custom_service_name }}

